{% include 'navbar.html' %}
{% load static %}
{% block content %}
<!DOCTYPE html>
<html lang="en">

<head>
    <title>{% block title %}Tourist Attraction{% endblock %}</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script> <!-- cleared -->
    <style>
        /* Custom card with image on top and content centered */
        body {
            background-image: url("{% static 'images/flowers.jpg' %}"); /* Path to the flower image */
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
        }
        .custom-card {
            background-color: #F5F5F4; /* Soft cream background */
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            text-align: center; /* Center content */
            padding: 20px;
        }

        .custom-card img {
            border-radius: 10px;
            max-width: 100%; /* Ensure image is responsive */
            height: auto;
            margin-bottom: 20px;
        }

        .custom-card:hover {
            transform: translateY(-5px);
            transition: transform 0.3s ease;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        /* Button style */
        .btn {
            background-color: #0369A1;
            color: white;
            font-weight: bold;
            padding: 12px 24px;
            border-radius: 50px;
            text-transform: uppercase;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #005280;
        }
    </style>
    {% block extra_head %}{% endblock %}
</head>

<body>
    <div class="container mx-auto pt-24 pb-10">
        <h1 class="text-5xl font-extrabold text-center mb-10 text-blue-900">Discover Jogja's Top Attractions</h1>

        <!-- Search Bar -->
        <div class="mb-6 max-w-lg mx-auto">
            <input type="text" id="search-input" class="border border-blue-300 rounded-lg w-full p-3 shadow-md bg-white text-blue-900 placeholder-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Search by name...">
        </div>

        <!-- Filter -->
        <div class="mb-6 max-w-lg mx-auto">
            <select id="type-filter" class="border border-blue-300 rounded-lg w-full p-3 shadow-md bg-white text-blue-900 focus:outline-none focus:ring-2 focus:ring-blue-400">
                <option value="">All Types</option>
            </select>
        </div>

        <!-- Card List -->
        <div id="attraction-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"> <!-- Adjust for grid layout -->
        </div>

        <!-- No Attractions Message -->
        <p id="no-attractions" class="text-center text-gray-700 hidden">No tourist attractions found.</p>
    </div>

    {% block scripts %}
    <script>
        let attractionsData = [];

        fetch("{% url 'get_tourist_attractions' %}")  
        .then(response => response.json())
        .then(data => {
            attractionsData = data.attractions || [];

            // Populate type filter options
            const typeFilter = document.getElementById('type-filter');
            const types = new Set();
            attractionsData.forEach(attraction => {
                if (attraction.type) {
                    attraction.type.split(',').forEach(type => {
                        types.add(type.trim());
                    });
                }
            });
            types.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                typeFilter.appendChild(option);
            });

            renderAttractions(attractionsData);
        })
        .catch(error => {
            console.error('Error fetching attractions:', error);
            const noAttractionsMessage = document.getElementById('no-attractions');
            noAttractionsMessage.textContent = 'Failed to load tourist attractions.';
            noAttractionsMessage.classList.remove('hidden');
        });

        function renderAttractions(attractions) {
            const attractionList = document.getElementById('attraction-list');
            attractionList.innerHTML = '';
            const noAttractionsMessage = document.getElementById('no-attractions');

            if (!attractions || attractions.length === 0) {
                noAttractionsMessage.classList.remove('hidden');
                return;
            } else {
                noAttractionsMessage.classList.add('hidden');
            }

            attractions.forEach(attraction => {
                const card = document.createElement('div');
                card.classList.add('custom-card', 'bg-white', 'rounded-lg', 'overflow-hidden');

                // Image Section
                const img = document.createElement('img');
                const typeValue = attraction.type ? attraction.type.split(',')[0].trim().replace(/\s+/g, '') : 'placeholder';
                img.src = `/static/images/${typeValue}.png`;
                img.alt = attraction.nama || 'Attraction Image';
                img.classList.add('mx-auto');

                // Details Section
                const detailsDiv = document.createElement('div');
                detailsDiv.classList.add('p-4');

                // Name Link
                const nameLink = document.createElement('a');
                nameLink.href = `/tourist_attraction/attractions/${attraction.id}`;
                nameLink.target = "_blank";
                nameLink.rel = "noopener noreferrer";
                nameLink.classList.add('text-2xl', 'font-bold', 'text-blue-900', 'mb-2');
                nameLink.textContent = attraction.nama || 'Unknown';

                // Rating, Vote Count, Type, HTM
                const rating = document.createElement('p');
                rating.classList.add('text-gray-700', 'mb-1');
                rating.textContent = `Rating: ${attraction.vote_average || 0} / 5`;

                const voteCount = document.createElement('p');
                voteCount.classList.add('text-gray-700', 'mb-1');
                voteCount.textContent = `Votes: ${attraction.vote_count || 0}`;

                const type = document.createElement('p');
                type.classList.add('text-gray-700', 'mb-1');
                type.textContent = `Type: ${attraction.type || 'Unknown'}`;

                const htmWeekday = document.createElement('p');
                htmWeekday.classList.add('text-gray-700', 'mb-1');
                htmWeekday.textContent = `HTM (Weekday): ${attraction.htm_weekday || 0} IDR`;

                const htmWeekend = document.createElement('p');
                htmWeekend.classList.add('text-gray-700', 'mb-1');
                htmWeekend.textContent = `HTM (Weekend): ${attraction.htm_weekend || 0} IDR`;

                const description = document.createElement('p');
                description.classList.add('text-gray-700', 'mb-4');
                description.textContent = attraction.description || 'No description available';
                if (description.textContent.length > 100) {
                    description.textContent = `${description.textContent.substring(0, 100)}...`;
                }

                // Google Maps Button
                const linkDiv = document.createElement('div');
                const googleMapsLink = document.createElement('a');
                googleMapsLink.href = attraction.gmaps_url || '#';
                googleMapsLink.target = "_blank";
                googleMapsLink.rel = "noopener noreferrer";
                googleMapsLink.classList.add('btn', 'mt-4', 'inline-block');
                googleMapsLink.textContent = 'View on Google Maps';

                // Append everything
                linkDiv.appendChild(googleMapsLink);
                detailsDiv.appendChild(nameLink);
                detailsDiv.appendChild(rating);
                detailsDiv.appendChild(voteCount);
                detailsDiv.appendChild(type);
                detailsDiv.appendChild(htmWeekday);
                detailsDiv.appendChild(htmWeekend);
                detailsDiv.appendChild(description);
                detailsDiv.appendChild(linkDiv);

                card.appendChild(img);
                card.appendChild(detailsDiv);

                attractionList.appendChild(card);
            });
        }

        document.getElementById('search-input').addEventListener('input', function() {
            filterAttractions();
        });

        document.getElementById('type-filter').addEventListener('change', function() {
            filterAttractions();
        });

        function filterAttractions() {
            const searchInput = document.getElementById('search-input').value.toLowerCase();
            const typeFilter = document.getElementById('type-filter').value;

            const filteredAttractions = attractionsData.filter(attraction => {
                const matchesName = attraction.nama && attraction.nama.toLowerCase().includes(searchInput);
                const matchesType = !typeFilter || (attraction.type && attraction.type.includes(typeFilter));
                return matchesName && matchesType;
            });

            renderAttractions(filteredAttractions);
        }
    </script>
    {% endblock %}
</body>

</html>
{% endblock %}
